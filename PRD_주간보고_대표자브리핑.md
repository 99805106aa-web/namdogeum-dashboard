# PRD — 주간보고 대표자 경영 브리핑 개선
**남도금속 스마트 품질 모니터링 대시보드**
작성일: 2026-02-26 | 버전: 1.0

---

## 1. 배경 및 목적

### 1.1 배경
현재 Tab 11 (주간보고)은 불량률·PPM·시그마·생산수량·목표초과일수 등
기본 KPI와 주별/월별 차트를 제공한다.
그러나 대표자가 경영 의사결정을 하려면 **11개 탭 전체의 분석 결과를
한 화면에서 맥락 있게 요약**해야 한다.

현재 브리핑이 답하지 못하는 질문:
- "공정이 통계적으로 안정적인가?" (SPC 관리도 탭 데이터 미반영)
- "수율 목표는 달성하고 있는가?" (수율 분석 탭 데이터 미반영)
- "지난 주와 이번 주 중 어느 기간이 더 문제인가?" (기간비교 탭 미반영)
- "AI가 진단한 종합 품질 등급은?" (AI 품질진단 탭 미반영)
- "지금 당장 어떤 조치를 해야 하는가?" (우선순위 있는 액션아이템 부재)

### 1.2 목적
주간에 발생한 품질 이슈를 **전 탭 분석 결과 기반**으로 종합하여,
대표자가 5분 이내에 현황을 파악하고 의사결정할 수 있는
**원페이지 경영 브리핑**을 제공한다.

### 1.3 기대 효과
| 항목 | 현재 | 개선 후 |
|------|------|---------|
| 커버하는 분석 탭 수 | 기본 KPI만 (1개) | 전체 탭 요약 (9개) |
| 인사이트 자동 생성 | 단순 임계값 비교 | 탭별 분석 결과 통합 |
| 액션 아이템 | 없음 | 우선순위별 조치 목록 |
| 대표자 전달 방법 | 인쇄/텍스트복사 | 인쇄 + PDF + 복사 |

---

## 2. 사용자 페르소나

### 주 사용자: 대표자 / 경영진
- 데이터 분석 전문 지식 없음
- 주 1회 품질 보고 수신
- **"지금 문제가 있는가? 무엇을 해야 하는가?"** 두 가지만 필요
- 숫자보다 신호(🟢🟡🔴)와 한 줄 요약 선호

### 보조 사용자: 품질관리 담당자
- 대표자에게 보고서를 제출하는 실무자
- 탭별 상세 데이터는 이미 파악하고 있음
- 브리핑 문서를 빠르게 생성·인쇄하는 것이 목표

---

## 3. 현재 구현 상태 분석 (As-Is)

### 3.1 Tab 11 현재 구성 요소
```
generateWeeklyReport(kpi, byDate, byItem, byWeek)
├── 헤더 (보고서 제목 + 기간)
├── 대표자 경영 브리핑 블록
│   ├── 신호등 (🟢🟡🔴) + 종합상태 (정상/주의/위험)
│   ├── 키워드 태그 (목표달성/불량개선세 등 ~6개)
│   └── 핵심 인사이트 (3~5개 자동 불릿)
├── KPI 카드 5개 (불량률/PPM/시그마/생산수량/초과일수)
├── 차트 2개 (주별 불량률 추이 / 월별 생산 실적)
├── 주간 비교 테이블 (이번 주 vs 전주)
├── 일별 실적 현황 테이블
├── 워스트5 / 베스트5 품목 테이블
└── 트렌드 & 시그마 요약 카드
```

### 3.2 현재 인사이트 생성 로직의 한계
```
현재: 단순 if/else 임계값 비교
  isOk = (curRate <= tgtRate)
  wChg = (이번 주 불량률 - 전주 불량률)
  → 5개 고정 문장 출력

누락된 데이터 소스:
  - Tab 5 SPC: UCL 이탈 횟수, 공정 안정성, 규칙 위반 건수
  - Tab 6 수율: 수율 달성률, 수율 하위 품목
  - Tab 7 기간비교: A기간 vs B기간 불량률 변화
  - Tab 9 AI진단: 품질 점수(0~100), 등급(A~F), 위험 품목 수
```

### 3.3 데이터 가용성
| 데이터 소스 | 전역 변수 | 현재 Tab 11 사용 여부 |
|------------|---------|-------------------|
| 기본 KPI | `calcKPI()` 반환값 | ✅ 사용 중 |
| 일별 집계 | `window._rawFiltered` → `byDate` | ✅ 사용 중 |
| 품목별 집계 | `byItem` | ✅ 사용 중 |
| 주별 집계 | `byWeek` | ✅ 사용 중 |
| 월별 집계 | `byMonth` | ✅ 차트에 사용 |
| SPC 통계 | `buildSPCKpiHtml(byDate)` 계산값 | ❌ 미사용 |
| 수율 분석 | `window._t6Data` | ❌ 미사용 |
| AI 진단 | `calcQualityScore()` 반환값 | ❌ 미사용 |
| 기간 비교 | `renderPeriodComparison()` 내부 | ❌ 미사용 |

---

## 4. 요구사항 (To-Be)

### 4.1 핵심 요구사항 (Must Have)

#### R-01. 전 탭 요약 섹션 추가
대표자 브리핑 하단에 **"탭별 분석 요약"** 섹션을 신설한다.
각 탭의 핵심 지표 1~2개와 상태 신호등을 한 행으로 표시한다.

```
표시 항목 (각 탭별 1행):
┌──────────────┬──────────┬─────────────────────────────┐
│ 분석 영역    │ 상태     │ 핵심 수치 / 한 줄 요약       │
├──────────────┼──────────┼─────────────────────────────┤
│ 📊 전체 품질  │ 🟢 정상  │ 불량률 0.82% · 목표 달성     │
│ 📈 SPC 관리도 │ 🟡 주의  │ UCL 이탈 2건 · 공정 점검 필요│
│ ✅ 수율 분석  │ 🟢 정상  │ 수율 98.7% · 목표(98%) 달성  │
│ 🤖 AI 진단   │ 🟠 경고  │ 품질점수 62점 · 등급 C       │
│ 📦 품목 위험  │ 🔴 위험  │ 위험품목 3개 · 즉시조치 필요 │
│ 🔄 기간 비교  │ 🟢 개선  │ 불량률 전주比 ▼0.15%p 감소  │
└──────────────┴──────────┴─────────────────────────────┘
```

#### R-02. 주간 이슈 타임라인
이번 주에 **목표를 초과한 날짜**와 **해당 일의 최고 불량 품목**을
날짜 순서대로 나열한 이슈 목록을 제공한다.

```
표시 형식:
🗓️ 2월 18일 (화)  불량률 1.52% ▲ 초과 (+0.72%p)  → 최고 위험: LS-A5000 (3.2%)
🗓️ 2월 20일 (목)  불량률 1.31% ▲ 초과 (+0.51%p)  → 최고 위험: KD-3300  (2.8%)
```

#### R-03. 우선순위 액션 아이템
인사이트에서 한 단계 나아가 **"지금 해야 할 일"**을
우선순위(긴급/이번 주/이번 달) 및 담당 기능(공정/품질/설비)으로 분류하여 표시한다.

```
🚨 긴급 (즉시 조치)
  □ [공정] LS-A5000 라인 점검 — 불량률 목표 2배 초과
  □ [품질] SPC UCL 이탈 2건 원인 조사 — 공정 불안정 신호

📋 이번 주
  □ [품질] 화·목요일 공통 불량 유형 분석 — 반복 패턴 확인 필요
  □ [공정] 수율 하위 3개 품목 공정 조건 재검토

📅 이번 달
  □ [관리] 불량률 3주 연속 개선 중 — 현 개선 활동 표준화 검토
```

#### R-04. SPC 인사이트 통합
`buildSPCKpiHtml(byDate)`의 계산 로직을 재활용하여
브리핑에 SPC 상태를 다음 형식으로 표시한다.

```
공정 안정성 (SPC):
  p̄(중심선) 0.82% | UCL 1.94% | 이탈 2건 → 🟡 주의
  "관리한계 이탈 2건 감지 — 이탈 일자 공정 변수 확인 필요"
```

#### R-05. 수율 인사이트 통합
`window._t6Data` 또는 byDate로부터 수율을 계산하여
목표 수율(98%) 대비 현황을 브리핑에 표시한다.

```
수율 분석:
  전체 수율 98.7% (목표 98%) → 🟢 달성
  수율 하위 품목: KD-3300 (95.2%), LS-B200 (96.1%)
```

#### R-06. AI 진단 점수 통합
`calcQualityScore()`의 반환값(score, letterGrade, verdict)을
브리핑 최상단 KPI 카드 영역에 추가한다.

```
KPI 카드 6번째 추가:
  AI 품질점수
  62점 / C등급
  "개선 활동 강화 필요"
```

### 4.2 보조 요구사항 (Should Have)

#### R-07. 주간 이슈 키워드 자동 태깅 고도화
현재 6개 고정 태그에서 **동적 태그 풀** 방식으로 확장한다.

```
추가될 태그 유형:
  🏭 공정불안정  (SPC 이탈 2건↑)
  📉 수율저하    (수율 < 목표 - 1%)
  🔁 반복불량    (같은 품목이 2주 연속 워스트)
  📆 요일패턴    (특정 요일에 불량 집중)
  ✨ 연속달성    (3일↑ 연속 목표 달성)
  📊 C등급 이하  (AI 품질점수 < 60)
```

#### R-08. 요일별 패턴 인사이트
Tab 2에서 제공하는 요일별 분석 결과를 요약한다.

```
"월요일·화요일 불량률이 평균보다 32% 높음 — 주초 준비 공정 점검 권고"
```

#### R-09. 전주 대비 변화 하이라이트
워스트5 테이블에 **"전주에도 워스트였는가"** 여부를 표시한다.

```
1위  LS-A5000  불량률 3.2%  [2주 연속 ↑]
2위  KD-3300   불량률 2.8%  [신규 진입 ↑]
```

### 4.3 제외 범위 (Won't Have — 이번 버전)
- 대표자에게 이메일/SMS 자동 발송
- 외부 ERP 시스템 연동
- 음성 브리핑 기능
- 영문 보고서 자동 번역

---

## 5. 화면 설계

### 5.1 전체 레이아웃 (세로 스크롤 단일 페이지)

```
┌─────────────────────────────────────────────────┐
│  HEADER: 주간 품질 경영 보고서 | 기간 | 작성일    │
├─────────────────────────────────────────────────┤
│  ZONE A: 대표자 경영 브리핑 (신호등 + 키워드태그) │
│          핵심 인사이트 (3~5줄)                   │
├─────────────────────────────────────────────────┤
│  ZONE B: 탭별 분석 요약 (6행 테이블) ← 신규      │
├─────────────────────────────────────────────────┤
│  ZONE C: KPI 카드 6개 (기존 5개 + AI점수) ← 변경 │
├─────────────────────────────────────────────────┤
│  ZONE D: 주간 이슈 타임라인 ← 신규               │
├─────────────────────────────────────────────────┤
│  ZONE E: 우선순위 액션 아이템 ← 신규             │
├─────────────────────────────────────────────────┤
│  ZONE F: 차트 2개 (주별 추이 / 월별 실적) ← 유지 │
├─────────────────────────────────────────────────┤
│  ZONE G: 주간 비교 테이블 ← 유지                 │
├─────────────────────────────────────────────────┤
│  ZONE H: 일별 실적 현황 ← 유지                   │
├─────────────────────────────────────────────────┤
│  ZONE I: 워스트5 / 베스트5 ← 연속여부 칼럼 추가  │
├─────────────────────────────────────────────────┤
│  ZONE J: SPC 공정 안정성 + 수율 요약 ← 신규      │
├─────────────────────────────────────────────────┤
│  ZONE K: 트렌드 & 시그마 ← 유지                  │
├─────────────────────────────────────────────────┤
│  FOOTER: 인쇄 | PDF | 텍스트복사 버튼            │
└─────────────────────────────────────────────────┘
```

### 5.2 ZONE B — 탭별 분석 요약 상세

```
┌──────────────┬──────┬──────────────────────────────────────┐
│ 분석 영역     │ 상태 │ 핵심 요약                             │
├──────────────┼──────┼──────────────────────────────────────┤
│ 📊 전체 품질  │  🟢  │ 불량률 0.82% — 목표(1.0%) 달성        │
│ 📅 일자별     │  🟡  │ 5일 중 2일 초과 (화·목 반복 패턴)      │
│ 📦 품목별     │  🔴  │ 위험품목 3개 — LS-A5000 즉시 조치     │
│ 📈 SPC 관리도 │  🟡  │ UCL 이탈 2건 — 공정 점검 필요         │
│ ✅ 수율 분석  │  🟢  │ 수율 98.7% — 목표(98%) 달성           │
│ 🤖 AI 진단   │  🟠  │ 품질점수 62점 C등급 — 개선 활동 강화  │
└──────────────┴──────┴──────────────────────────────────────┘
```

### 5.3 ZONE D — 주간 이슈 타임라인 상세

카드 형태로 초과일만 표시 (달성일은 표시 안 함):
```
이번 주 이슈 일지  (초과 2일 / 달성 3일)

  📍 2월 18일 화요일
     불량률 1.52%  목표 초과 +0.52%p
     최고 위험 품목: LS-A5000 (3.2%)
     SPC 이탈: 해당 일 UCL 초과

  📍 2월 20일 목요일
     불량률 1.31%  목표 초과 +0.31%p
     최고 위험 품목: KD-3300 (2.8%)
```

### 5.4 ZONE E — 우선순위 액션 아이템 상세

색상으로 긴급도 구분:
- 🚨 긴급 — 빨간 테두리 카드
- 📋 이번 주 — 주황 테두리 카드
- 📅 이번 달 — 파란 테두리 카드

각 항목:
```
[긴급도 뱃지] [담당 기능 태그] 내용 텍스트
```

---

## 6. 데이터 흐름 설계

### 6.1 신규 헬퍼 함수

```javascript
// SPC 요약 계산 (buildSPCKpiHtml 로직 재활용)
function calcSPCSummary(byDate)
  → { pbar, UCL, LCL, outCount, isStable }

// 수율 요약 계산
function calcYieldSummary(byDate, targetYield = 98)
  → { yieldPct, isOk, bottomItems[] }

// 탭별 분석 요약 생성
function buildTabSummaryRows(kpi, byDate, byItem, byWeek)
  → [ { tab, status, summary }[] ]

// 주간 이슈 타임라인 생성
function buildIssueTimeline(byDate, byItem, tgtRate)
  → [ { date, rate, diff, topItem }[] ] (초과일만)

// 우선순위 액션 아이템 생성
function buildActionItems(kpi, byDate, byItem, spc, yield_, aiScore)
  → { urgent[], thisWeek[], thisMonth[] }
```

### 6.2 generateWeeklyReport() 파라미터 확장

```javascript
// 현재
function generateWeeklyReport(kpi, byDate, byItem, byWeek)

// 변경 후
function generateWeeklyReport(kpi, byDate, byItem, byWeek, byMonth, aiScore)
//                                                          ↑ 신규   ↑ 신규
```

### 6.3 호출부 변경 (renderDashboard 내부)

```javascript
// 현재 (line ~5934)
const area = $('weeklyReportArea');
area.innerHTML = generateWeeklyReport(kpi, byDate, byItem, byWeek);

// 변경 후
const qs = calcQualityScore(kpi, analyzeTrends(byDate), detectAnomalies(byDate),
                            calcItemRiskScores(byItem, filtered, aiRiskSettings),
                            {yieldRate: ...}, targetDefectRate);
area.innerHTML = generateWeeklyReport(kpi, byDate, byItem, byWeek, byMonth, qs);
```

---

## 7. 인사이트 생성 규칙

### 7.1 신호등 판정 로직 (탭별)

| 탭 | 🟢 정상 | 🟡 주의 | 🔴 위험 |
|----|--------|--------|--------|
| 전체 품질 | 불량률 ≤ 목표 AND 초과일 < 30% | 불량률 ≤ 목표 AND 초과일 ≥ 30% | 불량률 > 목표 |
| 일자별 | 초과일 0 | 초과일 1~2 | 초과일 3↑ 또는 과반 |
| 품목별 | 위험품목 0 | 위험품목 1~2 | 위험품목 3↑ |
| SPC | 이탈 0건 | 이탈 1~2건 | 이탈 3건↑ |
| 수율 | 수율 ≥ 목표 | 수율 목표-1% ~ 목표 | 수율 < 목표-1% |
| AI 진단 | 점수 ≥ 75 | 점수 60~74 | 점수 < 60 |

### 7.2 액션 아이템 생성 규칙

| 조건 | 긴급도 | 분류 | 내용 |
|------|--------|------|------|
| 위험품목 불량률 > 목표×2 | 🚨 긴급 | 공정 | 해당 품목 라인 즉시 점검 |
| SPC UCL 이탈 ≥ 3건 | 🚨 긴급 | 공정 | 이탈 원인 긴급 조사 |
| 불량률 > 목표 AND 전주 대비 악화 | 🚨 긴급 | 품질 | 변동 원인 분석 및 대책 |
| SPC UCL 이탈 1~2건 | 📋 이번 주 | 품질 | 이탈 일자 특이 요인 확인 |
| 동일 품목 2주 연속 워스트 | 📋 이번 주 | 공정 | 해당 품목 공정 조건 재검토 |
| 수율 < 목표 | 📋 이번 주 | 품질 | 수율 하위 품목 공정 점검 |
| 특정 요일 불량 집중 | 📋 이번 주 | 관리 | 요일별 패턴 원인 분석 |
| AI 점수 < 60 | 📋 이번 주 | 품질 | 품질 개선 활동 계획 수립 |
| 3일↑ 연속 목표 달성 | 📅 이번 달 | 관리 | 현 개선 활동 표준화 검토 |
| 불량률 3주 연속 개선 | 📅 이번 달 | 관리 | 개선 사례 수평 전개 |

---

## 8. 구현 우선순위

### Phase 1 — 핵심 브리핑 강화 (Must Have)
| # | 작업 | 관련 요구사항 |
|---|------|-------------|
| 1 | `calcSPCSummary()` 헬퍼 함수 작성 | R-04 |
| 2 | `calcYieldSummary()` 헬퍼 함수 작성 | R-05 |
| 3 | `buildTabSummaryRows()` 작성 + ZONE B HTML 추가 | R-01 |
| 4 | `buildIssueTimeline()` 작성 + ZONE D HTML 추가 | R-02 |
| 5 | `buildActionItems()` 작성 + ZONE E HTML 추가 | R-03 |
| 6 | KPI 카드에 AI 품질점수 추가 (6번째 카드) | R-06 |
| 7 | `generateWeeklyReport()` 파라미터에 aiScore 추가 | R-06 |

### Phase 2 — 인사이트 고도화 (Should Have)
| # | 작업 | 관련 요구사항 |
|---|------|-------------|
| 8 | 키워드 태그 동적 풀 확장 | R-07 |
| 9 | 요일별 패턴 인사이트 자동 생성 | R-08 |
| 10 | 워스트5 테이블 "연속 여부" 칼럼 추가 | R-09 |

---

## 9. 비기능 요구사항

### 9.1 성능
- `generateWeeklyReport()` 실행 시간 200ms 이내
- 추가 헬퍼 함수들은 기존 집계 데이터를 재활용 (재계산 없음)

### 9.2 인쇄 / PDF
- 기존 `@media print` CSS 유지
- 신규 ZONE (B·D·E·J)에 `page-break-inside: avoid` 적용
- A4 1~2페이지 내 출력 가능하도록 폰트 크기 조정

### 9.3 반응형
- 모바일: 탭별 요약 테이블은 좌우 스크롤 허용
- 이슈 타임라인 / 액션 아이템은 단일 컬럼으로 표시

### 9.4 다크모드
- 신규 ZONE은 기존 `var(--bg)`, `var(--border)`, `var(--text)` CSS 변수 사용

---

## 10. 인수 기준 (Acceptance Criteria)

| 기준 | 검증 방법 |
|------|---------|
| 탭별 요약 6행이 정상 표시됨 | 데이터 로드 후 Tab 11 확인 |
| SPC 이탈 건수가 브리핑에 반영됨 | Tab 5 수치와 Tab 11 수치 일치 확인 |
| 수율 수치가 브리핑에 반영됨 | Tab 6 수치와 Tab 11 수치 일치 확인 |
| AI 점수가 KPI 카드에 표시됨 | Tab 9 점수와 Tab 11 점수 일치 확인 |
| 목표 초과일만 타임라인에 표시됨 | 달성일 포함 여부 확인 |
| 액션 아이템이 긴급도별로 분류됨 | 3개 구역 (긴급/이번주/이번달) 확인 |
| 인쇄 시 신규 섹션이 포함됨 | 브라우저 인쇄 미리보기 확인 |
| 데이터 없을 때 오류 없음 | 파일 미업로드 상태에서 Tab 11 클릭 확인 |

---

*이 문서는 남도금속 스마트 품질 모니터링 대시보드의 Tab 11 개선을 위한 PRD입니다.*
*구현 시 `dashboard.html` 단일 파일을 수정하며, 외부 라이브러리 추가 없이 기존 코드 재활용을 원칙으로 합니다.*
